{"version":3,"sources":["webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?d5f0","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?97dd","webpack:///src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?05ce","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","noMoreData","loading","_e","attrs","on","load_previous","_v","items","staticStyle","_l","messages","message","key","id","mentionables","$event","sendMessage","staticRenderFns","component"],"mappings":"yIAAA,yBAAsoB,EAAG,G,yCCAzoB,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,+BAA+B,CAACF,EAAG,MAAM,CAACG,IAAI,qBAAqBD,YAAY,YAAY,EAAqB,IAAnBN,EAAIQ,YAAyBR,EAAIS,QAAqST,EAAIU,KAAhSN,EAAG,QAAQ,CAACE,YAAY,OAAOK,MAAM,CAAC,aAAa,KAAK,CAACP,EAAG,QAAQ,CAACO,MAAM,CAAC,GAAK,KAAK,GAAK,OAAO,CAACP,EAAG,YAAYA,EAAG,QAAQ,CAACE,YAAY,0BAA0BK,MAAM,CAAC,KAAO,GAAG,MAAQ,IAAIC,GAAG,CAAC,MAAQZ,EAAIa,gBAAgB,CAACb,EAAIc,GAAG,4BAA4BV,EAAG,aAAa,IAAI,GAAaJ,EAAW,QAAEI,EAAG,oBAAoB,CAACO,MAAM,CAAC,eAAgB,KAAQX,EAAIU,KAAMV,EAAIe,MAAY,OAAEX,EAAG,QAAQ,CAACO,MAAM,CAAC,aAAa,KAAK,CAACP,EAAG,QAAQ,CAACE,YAAY,YAAYU,YAAY,CAAC,aAAa,SAASL,MAAM,CAAC,GAAK,OAAOX,EAAIiB,GAAIjB,EAAIkB,SAASlB,EAAIe,QAAQ,SAASI,GAAS,OAAOf,EAAG,UAAU,CAACgB,IAAID,EAAQE,GAAGV,MAAM,CAAC,QAAUQ,QAAa,IAAI,GAAGf,EAAG,MAAM,CAACE,YAAY,eAAe,CAACF,EAAG,QAAQ,CAACO,MAAM,CAAC,SAAW,sBAAsB,IAAI,GAAGP,EAAG,MAAM,CAACE,YAAY,cAAc,CAACF,EAAG,YAAY,CAACE,YAAY,OAAOK,MAAM,CAAC,aAAeX,EAAIsB,cAAcV,GAAG,CAAC,OAAS,SAASW,KAAU,eAAevB,EAAIwB,gBAAgB,MAC/oCC,EAAkB,G,yGCmCtB,GACE,KAAF,eACE,OAAF,gBACE,MAAF,CACI,GAAJ,iBAEE,WAAF,CACI,MAAJ,OACI,UAAJ,OACI,QAAJ,QAGE,KAAF,WAAI,MAAJ,CACM,SAAN,EACM,QAAN,KACM,aAAN,EACM,WAAN,OAGE,SAAF,CACI,WADJ,WAEM,OAAN,0BAEI,aAJJ,WAKM,OAAN,gBAGA,wBAFA,IAII,KAVJ,WAWM,OAAN,oCAEI,MAbJ,WAcM,MAAN,CACA,CAAQ,KAAR,YAAQ,UAAR,EAAQ,YAAR,mBACA,CAAQ,KAAR,UAAQ,UAAR,EAAQ,YAAR,MACA,CAAQ,KAAR,eAAQ,UAAR,EAAQ,YAAR,SAIE,QAxCF,WAyCI,KAAJ,uCACI,KAAJ,uBACI,KAAJ,mBAEE,cA7CF,WA8CI,KAAJ,sEAEE,QAhDF,WAgDI,IAAJ,OACI,KAAJ,WACI,KAAJ,0EACI,YAAJ,WACM,EAAN,sBACA,GACI,KAAJ,0BAGE,QAAF,CACI,gBADJ,SACA,GAAM,IAAN,OACM,EAAN,KACA,GACA,kBAAQ,IAAR,SACQ,EAAR,gBAEA,oBACQ,EAAR,eAGI,kBAXJ,WAWM,IAAN,OACM,YAAN,WACQ,IAAR,gCACA,IACU,EAAV,4BAEA,IAEI,cAnBJ,WAoBM,KAAN,0EAEI,gBAtBJ,SAsBA,GACA,6BAAQ,OAAR,gBACQ,KAAR,kBAGI,iBA3BJ,SA2BA,GACM,KAAN,cACA,uCACA,qEAEI,gBAhCJ,WAgCM,IAAN,OACA,gEACA,UAEM,EAAN,uCACA,iDAEM,EAAN,iDAAQ,OACR,0BAEM,EAAN,8CAAQ,OACR,2BAGI,YA9CJ,SA8CA,GAAM,IAAN,OACA,eACM,EAAN,4BACM,EAAN,sBACM,EAAN,qCAEA,kBACQ,EAAR,0BAGM,EAAN,KACA,WACA,kBAAQ,IAAR,SACQ,EAAR,sBAEA,oBACQ,EAAR,oBACQ,EAAR,sCAGI,SAlEJ,SAkEA,GACM,OAAN,oBChKmY,I,wBCQ/XC,EAAY,eACd,EACA3B,EACA0B,GACA,EACA,KACA,WACA,MAIa,aAAAC,E","file":"js/chunk-c1a4fd3e.2f1ed730.js","sourcesContent":["import mod from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=style&index=0&id=f6a097dc&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=style&index=0&id=f6a097dc&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"message__body team-messages\"},[_c('div',{ref:\"messages-container\",staticClass:\"messages\"},[(_vm.noMoreData === false && !_vm.loading)?_c('v-row',{staticClass:\"pa-3\",attrs:{\"no-gutters\":\"\"}},[_c('v-col',{attrs:{\"md\":\"12\",\"xs\":\"12\"}},[_c('v-spacer'),_c('v-btn',{staticClass:\"view__more_btn overline\",attrs:{\"text\":\"\",\"block\":\"\"},on:{\"click\":_vm.load_previous}},[_vm._v(\"Load Previous Messages\")]),_c('v-spacer')],1)],1):_vm._e(),(_vm.loading)?_c('v-progress-linear',{attrs:{\"indeterminate\":true}}):_vm._e(),(_vm.items.length)?_c('v-row',{attrs:{\"no-gutters\":\"\"}},[_c('v-col',{staticClass:\"px-3 py-2\",staticStyle:{\"min-height\":\"350px\"},attrs:{\"md\":\"12\"}},_vm._l((_vm.messages(_vm.items)),function(message){return _c('Message',{key:message.id,attrs:{\"message\":message}})}),1)],1):_c('div',{staticClass:\"no-messages\"},[_c('Empty',{attrs:{\"headline\":\"No messages yet\"}})],1)],1),_c('div',{staticClass:\"write px-3\"},[_c('ChatField',{staticClass:\"mt-2\",attrs:{\"mentionables\":_vm.mentionables},on:{\"typing\":function($event){},\"send-message\":_vm.sendMessage}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div class=\"message__body team-messages\">\n        <div class=\"messages\" ref=\"messages-container\">\n            <v-row no-gutters class=\"pa-3\" v-if=\"noMoreData === false && !loading\">\n                <v-col md=\"12\" xs=\"12\">\n                    <v-spacer></v-spacer>\n                    <v-btn text block class=\"view__more_btn overline\" @click=\"load_previous\">Load Previous Messages</v-btn>\n                    <v-spacer></v-spacer>\n                </v-col>\n            </v-row>\n            <v-progress-linear v-if=\"loading\" :indeterminate=\"true\"></v-progress-linear>\n            <v-row no-gutters v-if=\"items.length\">\n                <v-col md=\"12\" class=\"px-3 py-2\" style=\"min-height: 350px;\">\n                    <Message v-for=\"message in messages(items)\" :message=\"message\" :key=\"message.id\"></Message>\n                </v-col>\n            </v-row>\n            <div class=\"no-messages\" v-else>\n                <Empty headline=\"No messages yet\"></Empty>\n            </div>\n        </div>\n        <div class=\"write px-3\">\n            <ChatField class=\"mt-2\" :mentionables=\"mentionables\" @typing=\"\" @send-message=\"sendMessage\"></ChatField>\n        </div>\n    </div>\n</template>\n<script>\nimport * as apiTo from './api'\nimport { global_utils } from '@/global_utils/global_utils'\nimport { list_functionality } from '@/services/list-functionality/list-functionality'\nimport _cloneDeep from 'lodash/cloneDeep'\n\n// Components\nimport Empty from '@/common/Empty.vue'\nimport ChatField from '@/common/ChatBox/ChatField.vue'\nimport Message from '@/modules/Chat/components/Message/Message.vue'\n\nexport default {\n    name: 'TeamMessages',\n    mixins: [global_utils, list_functionality],\n    props: {\n        id: [Number, String]\n    },\n    components: {\n        Empty,\n        ChatField,\n        Message\n    },\n\n    data: () => ({\n        loading: false,\n        message: null,\n        can_message: false,\n        activeChat: null\n    }),\n\n    computed: {\n        loggedUser() {\n            return this.$store.getters.user\n        },\n        mentionables() {\n            if (!this.activeChat) {\n                return []\n            }\n            return this.activeChat.members\n        },\n        type() {\n            return this.$route.params.type || 'project'\n        },\n        paths() {\n            return [\n                { text: 'Dashboard', disabled: false, router_name: 'default-content' },\n                { text: this.type, disabled: true, router_name: null },\n                { text: 'Team Message', disabled: true, router_name: null }\n            ]\n        }\n    },\n    mounted() {\n        this.$event.$emit('path-change', this.paths)\n        this.$pusher.authenticate()\n        this.subscribePusher()\n    },\n    beforeDestroy() {\n        this.$pusher.unsubscribe(`private-project.team-message.${this.id}`)\n    },\n    created() {\n        this.loading = true\n        this.fill_table_via_url(`api/projects/${this.id}/messages?type=team`)\n        setTimeout(() => {\n            this.scrollToBottomDiv()\n        }, 1)\n        this.getConvoDetails(this.id)\n    },\n\n    methods: {\n        getConvoDetails(id) {\n            apiTo\n                .get_client_convo_details(id)\n                .then(({ data }) => {\n                    this.activeChat = data\n                })\n                .finally(() => {\n                    this.loading = false\n                })\n        },\n        scrollToBottomDiv() {\n            setTimeout(() => {\n                const wrapper = this.$refs['messages-container']\n                if (wrapper) {\n                    wrapper.scrollTop = wrapper.scrollHeight\n                }\n            }, 1)\n        },\n        load_previous() {\n            this.load_more_via_url(`api/projects/${this.id}/messages?type=team`)\n        },\n        add_new_message(message) {\n            if (!this.items.some(msg => msg.id === message.id)) {\n                this.items.unshift(message)\n            }\n        },\n        user_can_message(can) {\n            this.can_message = can\n            if (can) console.log('Client chat connected')\n            else this.$event.$emit('open_snackbar', 'Team chat unavailable.', 'error')\n        },\n        subscribePusher() {\n            const team_message_channel = this.$pusher.subscribe(\n                `private-project.team-message.${this.id}`\n            )\n            team_message_channel.bind('ProjectTeamMessage', data => {\n                if (data.type === 'team') this.add_new_message(data.message)\n            })\n            team_message_channel.bind('pusher:subscription_succeeded', () =>\n                this.user_can_message(true)\n            )\n            team_message_channel.bind('pusher:subscription_error', status =>\n                this.user_can_message(false)\n            )\n        },\n        sendMessage(data) {\n            let formData = new FormData()\n            formData.append('message', data.message)\n            formData.append('type', 'team')\n            formData.append('from_id', this.loggedUser.id)\n\n            if (data.files.length > 0) {\n                formData.append('file', data.files[0])\n            }\n\n            apiTo\n                .send_message(this.id, formData)\n                .then(({ data }) => {\n                    this.add_new_message(data)\n                })\n                .finally(() => {\n                    this.scrollToBottomDiv()\n                    this.$event.$emit('btnsending_off', false)\n                })\n        },\n        messages(items) {\n            return _cloneDeep(items).reverse()\n        }\n    }\n}\n</script>\n<style lang=\"scss\" scoped>\n@import '~@/sass/_variables';\n\n.message__body {\n    border: 1px solid $borderLightGray;\n    border-bottom-left-radius: 10px;\n    border-bottom-right-radius: 10px;\n\n    @include styledScrollFor('.messages'); //style the scroll\n\n    .messages {\n        background-color: $white;\n        overflow: auto;\n        max-height: 462px;\n        border-bottom: 1px solid $borderLightGray;\n    }\n\n    .write {\n        display: flex;\n        flex-direction: row;\n        flex-wrap: nowrap;\n        align-items: center;\n        background-color: $white;\n\n        .write__actions {\n            .action {\n                margin: 5px 7px;\n                color: $lightGray-2;\n                cursor: pointer;\n\n                &:hover {\n                    color: $blue;\n                }\n            }\n        }\n\n        .avatar-wrapper {\n            padding: 3px;\n\n            .sender-avatar {\n                width: 40px;\n            }\n        }\n    }\n\n    .view__more {\n        text-align: center;\n        padding: 10px;\n        border-top: 1px solid $borderLightGray;\n        background-color: $white;\n        border-bottom-left-radius: 10px;\n        border-bottom-right-radius: 10px;\n\n        .view__more_btn {\n            color: $tableDarkText;\n        }\n    }\n}\n</style>","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TeamMessages.vue?vue&type=template&id=f6a097dc&scoped=true&\"\nimport script from \"./TeamMessages.vue?vue&type=script&lang=js&\"\nexport * from \"./TeamMessages.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TeamMessages.vue?vue&type=style&index=0&id=f6a097dc&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f6a097dc\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}