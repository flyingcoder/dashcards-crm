{"version":3,"sources":["webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?37fb","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?1691","webpack:///src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?05ce","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","noMoreData","loading","_e","attrs","on","load_previous","_v","items","length","_l","messages","message","key","id","sender","loggedUser","image_url","$event","type","indexOf","_k","keyCode","sendMessage","target","value","model","callback","$$v","expression","staticRenderFns","mixins","global_utils","props","Number","String","components","Loader","SingleMessage","Empty","data","computed","$store","getters","user","mounted","$pusher","authenticate","subscribePusher","beforeDestroy","unsubscribe","created","fill_table_via_url","setTimeout","methods","scrollToBottomDiv","wrapper","scrollTop","scrollHeight","load_more_via_url","add_new_message","some","unshift","user_can_message","can_message","can","$emit","team_message_channel","bind","from_id","api","component"],"mappings":"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","file":"js/chunk-e8edede0.5fafa23e.js","sourcesContent":["import mod from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=style&index=0&id=4689228e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=style&index=0&id=4689228e&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"message__body team-messages\"},[_c('div',{ref:\"messages-container\",staticClass:\"messages\"},[(_vm.noMoreData === false && !_vm.loading)?_c('v-row',{staticClass:\"pa-3\",attrs:{\"no-gutters\":\"\"}},[_c('v-col',{attrs:{\"md\":\"12\",\"xs\":\"12\"}},[_c('v-spacer'),_c('v-btn',{staticClass:\"view__more_btn overline\",attrs:{\"text\":\"\",\"block\":\"\"},on:{\"click\":_vm.load_previous}},[_vm._v(\"Load Previous Messages\")]),_c('v-spacer')],1)],1):_vm._e(),_c('Loader',{attrs:{\"loading\":_vm.loading}}),(_vm.items.length > 0)?_vm._l((_vm.messages(_vm.items)),function(message){return _c('SingleMessage',{key:message.id,attrs:{\"is-my-message\":message.sender.id === _vm.loggedUser.id,\"message\":message}})}):_c('div',{staticClass:\"no-messages\"},[_c('Empty',{attrs:{\"headline\":\"No messages yet\"}})],1)],2),_c('div',{staticClass:\"write\"},[_c('div',{staticClass:\"avatar-wrapper\"},[_c('img',{staticClass:\"sender-avatar\",attrs:{\"src\":_vm.loggedUser.image_url}})]),_c('v-text-field',{staticClass:\"write__msg\",attrs:{\"solo\":\"\",\"flat\":\"\",\"hide-details\":\"\",\"color\":\"#667187\",\"label\":\"Type a message...\"},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.sendMessage($event.target.value)}},model:{value:(_vm.message),callback:function ($$v) {_vm.message=$$v},expression:\"message\"}}),_c('div',{staticClass:\"write__actions\"},[_c('v-icon',{staticClass:\"action insert__emoticon\"},[_vm._v(\"insert_emoticon\")]),_c('v-icon',{staticClass:\"action attach_file\"},[_vm._v(\"attach_file\")]),_c('v-icon',{staticClass:\"action send\",on:{\"click\":function($event){return _vm.sendMessage(_vm.message)}}},[_vm._v(\"send\")])],1)],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"message__body team-messages\">\r\n    <div class=\"messages\" ref=\"messages-container\">\r\n      <v-row no-gutters class=\"pa-3\" v-if=\"noMoreData === false && !loading\">\r\n        <v-col md=\"12\" xs=\"12\">\r\n          <v-spacer></v-spacer>\r\n          <v-btn\r\n            text\r\n            block\r\n            class=\"view__more_btn overline\"\r\n            @click=\"load_previous\"\r\n            >Load Previous Messages</v-btn\r\n          >\r\n          <v-spacer></v-spacer>\r\n        </v-col>\r\n      </v-row>\r\n\r\n      <Loader :loading=\"loading\" />\r\n\r\n      <template v-if=\"items.length > 0\">\r\n        <SingleMessage\r\n          v-for=\"message of messages(items)\"\r\n          :key=\"message.id\"\r\n          :is-my-message=\"message.sender.id === loggedUser.id\"\r\n          :message=\"message\"\r\n        />\r\n      </template>\r\n      <div class=\"no-messages\" v-else>\r\n        <Empty headline=\"No messages yet\"></Empty>\r\n      </div>\r\n    </div>\r\n    <div class=\"write\">\r\n      <div class=\"avatar-wrapper\">\r\n        <img :src=\"loggedUser.image_url\" class=\"sender-avatar\" />\r\n      </div>\r\n      <v-text-field\r\n        v-model=\"message\"\r\n        class=\"write__msg\"\r\n        solo\r\n        flat\r\n        hide-details\r\n        color=\"#667187\"\r\n        label=\"Type a message...\"\r\n        @keyup.enter=\"sendMessage($event.target.value)\"\r\n      ></v-text-field>\r\n      <div class=\"write__actions\">\r\n        <v-icon class=\"action insert__emoticon\">insert_emoticon</v-icon>\r\n        <v-icon class=\"action attach_file\">attach_file</v-icon>\r\n        <v-icon class=\"action send\" @click=\"sendMessage(message)\">send</v-icon>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as apiTo from './api'\r\nimport { global_utils } from '@/global_utils/global_utils'\r\nimport { list_functionality } from '@/services/list-functionality/list-functionality'\r\nimport _cloneDeep from 'lodash/cloneDeep'\r\n\r\n// Components\r\nimport Loader from '@/common/BaseComponents/Loader.vue'\r\nimport SingleMessage from '../reusable/SingleMessage.vue'\r\nimport Empty from '@/common/Empty.vue'\r\n\r\nexport default {\r\n  mixins: [global_utils, list_functionality],\r\n  props: {\r\n    id: [Number, String]\r\n  },\r\n  components: {\r\n    Loader,\r\n    SingleMessage,\r\n    Empty\r\n  },\r\n\r\n  data: () => ({\r\n    loading: false,\r\n    message: null,\r\n    can_message: false\r\n  }),\r\n\r\n  computed: {\r\n    loggedUser() {\r\n      return this.$store.getters.user\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$pusher.authenticate()\r\n    this.subscribePusher()\r\n  },\r\n  beforeDestroy() {\r\n    this.$pusher.unsubscribe(`private-project.team-message.${this.id}`)\r\n  },\r\n  created() {\r\n    this.loading = true\r\n    this.fill_table_via_url(`api/projects/${this.id}/messages?type=team`)\r\n    setTimeout(() => {\r\n      this.scrollToBottomDiv()\r\n    }, 1)\r\n  },\r\n\r\n  methods: {\r\n    scrollToBottomDiv() {\r\n      setTimeout(() => {\r\n        const wrapper = this.$refs['messages-container']\r\n        if (wrapper) {\r\n          wrapper.scrollTop = wrapper.scrollHeight\r\n        }\r\n      }, 1)\r\n    },\r\n    load_previous() {\r\n      this.load_more_via_url(`api/projects/${this.id}/messages?type=team`)\r\n    },\r\n    add_new_message(message) {\r\n      if (!this.items.some(msg => msg.id === message.id)) {\r\n        this.items.unshift(message)\r\n      }\r\n    },\r\n    user_can_message(can) {\r\n      this.can_message = can\r\n      if (can) this.$event.$emit('open_snackbar', 'Team chat connected')\r\n      else\r\n        this.$event.$emit('open_snackbar', 'Team chat disconnected.', 'error')\r\n    },\r\n    subscribePusher() {\r\n      const team_message_channel = this.$pusher.subscribe(\r\n        `private-project.team-message.${this.id}`\r\n      )\r\n      team_message_channel.bind('ProjectTeamMessage', data => {\r\n        if (data.type === 'team') this.add_new_message(data.message)\r\n      })\r\n      team_message_channel.bind('pusher:subscription_succeeded', () =>\r\n        this.user_can_message(true)\r\n      )\r\n      team_message_channel.bind('pusher:subscription_error', status =>\r\n        this.user_can_message(false)\r\n      )\r\n    },\r\n    sendMessage(message) {\r\n      if (!message) return\r\n      this.message = null\r\n      let payload = {\r\n        type: 'team',\r\n        message,\r\n        from_id: this.loggedUser.id\r\n      }\r\n      apiTo\r\n        .send_message(this.id, payload)\r\n        .then(({ data }) => {\r\n          this.add_new_message(data)\r\n        })\r\n        .finally(() => {\r\n          this.scrollToBottomDiv()\r\n        })\r\n    },\r\n    messages(items) {\r\n      return _cloneDeep(items).reverse()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '~@/sass/_variables';\r\n\r\n.message__body {\r\n  border: 1px solid $borderLightGray;\r\n  border-bottom-left-radius: 10px;\r\n  border-bottom-right-radius: 10px;\r\n\r\n  @include styledScrollFor('.messages'); //style the scroll\r\n\r\n  .messages {\r\n    background-color: $white;\r\n    overflow: auto;\r\n    max-height: 462px;\r\n    border-bottom: 1px solid $borderLightGray;\r\n  }\r\n\r\n  .write {\r\n    display: flex;\r\n    flex-direction: row;\r\n    flex-wrap: nowrap;\r\n    align-items: center;\r\n    background-color: $white;\r\n    .write__actions {\r\n      .action {\r\n        margin: 5px 7px;\r\n        color: $lightGray-2;\r\n        cursor: pointer;\r\n\r\n        &:hover {\r\n          color: $blue;\r\n        }\r\n      }\r\n    }\r\n    .avatar-wrapper {\r\n      padding: 3px;\r\n      .sender-avatar {\r\n        width: 40px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .view__more {\r\n    text-align: center;\r\n    padding: 10px;\r\n    border-top: 1px solid $borderLightGray;\r\n    background-color: $white;\r\n    border-bottom-left-radius: 10px;\r\n    border-bottom-right-radius: 10px;\r\n    .view__more_btn {\r\n      color: $tableDarkText;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TeamMessages.vue?vue&type=template&id=4689228e&scoped=true&\"\nimport script from \"./TeamMessages.vue?vue&type=script&lang=js&\"\nexport * from \"./TeamMessages.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TeamMessages.vue?vue&type=style&index=0&id=4689228e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4689228e\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}