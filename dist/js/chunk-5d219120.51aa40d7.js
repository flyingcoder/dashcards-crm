(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d219120"],{2220:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat"},[s("v-card",{staticClass:"chat-container",attrs:{flat:""}},[s("v-card-text",{attrs:{"no-gutters":""}},[s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("ChatList",{attrs:{loading:e.contact_list_loading,user_list:e.user_list,group_list:e.group_list,selected:e.active_chat},on:{"open-chat":e.open_conversation,"add-new-chat-group":function(t){return e.$refs.create_group_chat.open_dialog()}}})],1),s("v-col",[s("ChatBox",{attrs:{conversation:e.active_chat,"message-height":e.chat_message_height},on:{"manage-chat-members":e.open_manage_members_dialog}})],1)],1)],1)],1),s("GroupChatDialog",{ref:"create_group_chat",attrs:{"user-list":e.user_list},on:{"new-chat-group-created":e.new_groupchat_added}}),s("ManageMembersDialog",{ref:"manage_group_members_dialog",attrs:{"user-list":e.user_list,conversation:e.active_chat},on:{"conversation-updated":e.conversation_updated}})],1)},a=[],n=(s("20d6"),s("5b6f")),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"mx-auto",attrs:{flat:"",outlined:""}},[s("v-toolbar",{attrs:{color:"#3b589e",dark:""}},[s("Avatar",{attrs:{user:e.user}}),s("v-spacer"),s("v-tooltip",{attrs:{left:""},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[s("v-btn",e._g({attrs:{icon:""},on:{click:function(t){return e.$emit("add-new-chat-group")}}},i),[s("v-icon",[e._v("mdi-comment-plus")])],1)]}}])},[s("span",[e._v("New Group Chat")])])],1),e.loading?e._l(5,(function(e){return s("v-skeleton-loader",{key:e,ref:"skeleton",refInFor:!0,staticClass:"mx-auto",attrs:{type:"list-item-avatar-two-line"}})})):e._e(),e.loading?e._e():s("section",{staticStyle:{"min-height":"500px","max-height":"500px","overflow-y":"auto"},attrs:{id:"chat-list-wrapper"}},[s("v-list",{attrs:{dense:""}},e._l(e.group_list,(function(t){return s("v-list-item",{key:t.id,class:e.is_active_conversation(t),on:{click:function(s){return e.open_conversation(t)}}},[s("v-list-item-content",[s("v-row",{attrs:{"no-gutters":""}},[s("Avatars",{staticStyle:{display:"block"},attrs:{items:t.users,count:1}}),s("v-col",[s("v-list-item-title",{staticClass:"ml-2 mt-4",domProps:{textContent:e._s(t.data.group_name)}})],1)],1)],1),s("v-list-item-icon",[s("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.message_count>0,expression:"group.message_count > 0"}],staticClass:"has_message",attrs:{color:"success",title:"New message"}},[e._v(" mdi-email-alert-outline ")])],1)],1)})),1),s("v-divider"),s("v-list",{attrs:{dense:""}},e._l(e.sortByOnlineStatus,(function(t){return s("v-list-item",{key:t.conversation.id,class:e.is_active_conversation(t.conversation),on:{click:function(s){return e.open_conversation(t.conversation)}}},[s("v-list-item-content",[s("v-row",{attrs:{"no-gutters":""}},[s("Avatar",{attrs:{user:t,"icon-only":""}}),s("v-col",[s("v-list-item-title",{domProps:{textContent:e._s(t.fullname)}}),s("v-list-item-subtitle",{domProps:{textContent:e._s(t.job_title)}})],1)],1)],1),s("v-list-item-icon",[s("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.message_count>0,expression:"user.message_count > 0"}],staticClass:"has_message",attrs:{color:"success",title:"New message"}},[e._v(" mdi-email-alert-outline ")])],1)],1)})),1)],1)],2)},o=[],c=(s("8e6e"),s("ac6a"),s("456d"),s("55dd"),s("ade3")),l=s("72c1"),u=s("2f62"),_=s("0644"),d=s.n(_);function v(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function h(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?v(Object(s),!0).forEach((function(t){Object(c["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):v(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var m={name:"ChatList",components:{Avatars:l["a"]},props:{user_list:Array,group_list:Array,selected:Object,loading:{type:Boolean,default:!1}},data:function(){return{active_chat:null}},computed:h(h({},Object(u["c"])(["user"])),{},{sortByOnlineStatus:function(){return this.user_list&&0!==this.user_list.length?d()(this.user_list).slice().sort((function(e,t){return e.is_online===t.is_online?0:e.is_online?-1:1})):[]}}),watch:{selected:function(e){this.active_chat=e}},mounted:function(){var e=this;this.$event.$on("new-chat-message-received",(function(t){e.add_message_count(t.conversation)}))},methods:{open_conversation:function(e){this.active_chat=e,this.$emit("open-chat",e)},add_message_count:function(e){if(e)if(e.type){var t=this.group_list.findIndex((function(t){return t.id===e.id}));~t&&(this.group_list[t].message_count+=1)}else{var s=this.user_list.findIndex((function(t){return t.conversation.id===e.id}));~s&&(this.user_list[s].message_count+=1)}},is_active_conversation:function(e){return this.active_chat&&this.active_chat.id===e.id?"active":""}}},p=m,f=(s("bf29"),s("2877")),g=Object(f["a"])(p,r,o,!1,null,"754ee902",null),b=g.exports,y=s("dbc2"),w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-center"},[s("v-dialog",{attrs:{"max-width":"800",persistent:"",scrollable:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[e._v(" Create Group "),s("v-spacer"),s("v-icon",{on:{click:function(t){return e.clear_and_close()}}},[e._v("close")])],1),s("v-card-text",[s("v-container",[s("v-row",{attrs:{"no-gutters":""}},[s("v-col",{attrs:{sm:"12",md:"8"}},[s("v-text-field",{attrs:{flat:"",dense:"",outlined:"",solo:"","prepend-inner-icon":"mdi-dialpad",clearable:"",label:"Group Name*",required:""},model:{value:e.group_name,callback:function(t){e.group_name=t},expression:"group_name"}}),s("v-text-field",{attrs:{flat:"",dense:"",outlined:"",solo:"",label:"Search for people to add",required:"",clearable:"","prepend-inner-icon":"search"},on:{keydown:e.filter_users,"click:clear":e.filter_users},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e.filtered_by_search.length>0?s("v-list",{attrs:{dense:"",id:"filtered_by_search_wrapper"}},e._l(e.filtered_by_search,(function(t){return s("v-list-item",{key:t.title,on:{click:function(s){return e.selected(t)}}},[s("v-list-item-avatar",[s("v-img",{attrs:{src:t.image_url}})],1),s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.fullname)}}),s("v-list-item-subtitle",{domProps:{textContent:e._s(t.job_title)}})],1),s("v-list-item-icon",[s("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.is_selected,expression:"item.is_selected"}],attrs:{color:"success"}},[e._v(" mdi-checkbox-marked-circle ")])],1)],1)})),1):e._e()],1),s("v-col",{attrs:{sm:"12",md:"4"}},[s("v-list",{attrs:{subheader:"",dense:"",id:"all_selected_wrapper"}},[s("v-subheader",[e._v("Selected ("+e._s(e.all_selected.length)+")")]),e.all_selected.length>0?e._l(e.all_selected,(function(t){return s("v-list-item",{key:t.title},[s("v-list-item-avatar",[s("v-img",{attrs:{src:t.image_url}})],1),s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.fullname)}}),s("v-list-item-subtitle",{domProps:{textContent:e._s(t.job_title)}})],1),s("v-list-item-icon",[s("v-icon",{attrs:{small:"",color:"danger"},on:{click:function(s){return e.selected(t)}}},[e._v("close")])],1)],1)})):e._e()],2)],1)],1)],1)],1),s("v-divider"),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{disabled:e.btnloading},on:{click:e.clear_and_close}},[e._v(" Cancel ")]),s("v-btn",{attrs:{dark:"",color:"#3b589e",loading:e.btnloading},on:{click:e.save_group}},[s("v-icon",{attrs:{small:"",left:""}},[e._v("save")]),e._v(" Create ")],1)],1)],1)],1)],1)},x=[],k=(s("6762"),s("2fdb"),s("386d"),s("1be9")),C={get_chat_list:function(){return k["a"].get("api/chat/list?for=project&has_msg_count=true")},get_chat_list_only:function(){return k["a"].get("api/chat/conversations/list?has_msg_count=false")},get_groupchat_list:function(){return k["a"].get("api/chat/group/list?for=project&has_msg_count=true")},get_members_list:function(e){return k["a"].get("api/chat/group/members/".concat(e))},get_messages:function(e){return k["a"].get("api/chat/private/".concat(e))},get_more_messages:function(e,t){return k["a"].get("api/chat/private/".concat(e,"?page=").concat(t+1))},get_group_messages:function(e){return k["a"].get("api/chat/group/private/".concat(e))},get_group_more_messages:function(e,t){return k["a"].get("api/chat/group/private/".concat(e,"?page=").concat(t+1))},send_message:function(e){return k["a"].post("api/chat/private",e,{headers:{"Content-Type":"multipart/form-data"}})},send_group_message:function(e){return k["a"].post("api/chat/group/private",e,{headers:{"Content-Type":"multipart/form-data"}})},save_group:function(e){return k["a"].post("api/chat/conversations",e)},update_members_list:function(e,t){return k["a"].post("api/chat/conversations/".concat(e,"/members"),t)},remove_from_group:function(e){return k["a"].post("api/chat/group/remove-member",e)}},O={name:"GroupChatDialog",props:{userList:Array},data:function(){return{dialog:!1,all_users:[],filtered_by_search:[],all_selected:[],search:"",group_name:"",btnloading:!1}},watch:{dialog:{handler:function(e){e&&this.userList&&(this.all_users=d()(this.userList),this.filtered_by_search=d()(this.userList))},immediate:!0}},methods:{validate_form:function(){return""===this.group_name?(this.$event.$emit("open_snackbar","Group name is required","error"),!1):!(this.all_selected.length<1)||(this.$event.$emit("open_snackbar","Select and  add users to group","error"),!1)},save_group:function(){var e=this;if(this.validate_form()){this.btnloading=!0;var t={group_name:this.group_name,users:this.all_selected.map((function(e){return e.id}))};C.save_group(t).then((function(t){var s=t.data;e.$emit("new-chat-group-created",s),e.$event.$emit("open_snackbar","New conversation group created"),e.clear_and_close()})).finally((function(){return e.btnloading=!1}))}},open_dialog:function(){this.dialog=!0},clear_and_close:function(){this.dialog=!1,this.all_selected=[],this.search="",this.group_name="",this.filtered_by_search=d()(this.all_users)},select:function(e,t){var s=this.filtered_by_search.findIndex((function(t){return e.id===t.id}));~s&&(this.filtered_by_search[s].is_selected=t)},selected:function(e){var t=this.all_selected.findIndex((function(t){return e.id===t.id}));~t?(this.select(e,!1),this.all_selected.splice(t,1)):(this.select(e,!0),this.all_selected.push(e))},filter_users:function(e){var t=this;setTimeout((function(){t.search&&""!==t.search?t.filtered_by_search=d()(t.all_users).filter((function(e){return e.fullname.toLowerCase().includes(t.search.toLowerCase().trim())})):t.filtered_by_search=d()(t.all_users)}),1)}}},j=O,$=(s("a63f"),Object(f["a"])(j,w,x,!1,null,"e5ad1130",null)),P=$.exports,I=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-center"},[s("v-dialog",{attrs:{"max-width":"800",persistent:"",scrollable:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[e._v(" Manage Members "),s("v-spacer"),s("v-icon",{on:{click:function(t){return e.clear_and_close()}}},[e._v("close")])],1),s("v-card-text",[s("v-container",[s("v-row",[s("v-col",{attrs:{sm:"12",md:"8"}},[s("v-text-field",{attrs:{solo:"",flat:"",label:"Search for people to add",required:"",outlined:"",clearable:"","prepend-inner-icon":"search"},on:{keydown:e.filter_users,"click:clear":e.filter_users},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e.filtered_by_search.length>0?s("v-list",{attrs:{id:"filtered_by_search_wrapper"}},e._l(e.filtered_by_search,(function(t){return s("v-list-item",{key:t.title,on:{click:function(s){return e.selected(t)}}},[s("v-list-item-avatar",[s("v-img",{attrs:{src:t.image_url}})],1),s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.fullname)}})],1),s("v-list-item-icon",[s("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.is_selected,expression:"item.is_selected"}],attrs:{color:"success"}},[e._v(" mdi-checkbox-marked-circle ")])],1)],1)})),1):e._e()],1),s("v-col",{attrs:{sm:"12",md:"4"}},[s("v-list",{attrs:{id:"all_selected_wrapper"}},[s("v-subheader",[e._v(" Selected ("+e._s(e.all_selected.length)+") ")]),e.all_selected.length>0?e._l(e.all_selected,(function(t){return s("v-list-item",{key:t.title},[s("v-list-item-avatar",[s("v-img",{attrs:{src:t.image_url}})],1),s("v-list-item-content",[s("v-list-item-subtitle",{domProps:{textContent:e._s(t.fullname)}})],1),e.can_be_remove(t)?s("v-list-item-icon",[s("v-icon",{attrs:{small:"",color:"danger"},on:{click:function(s){return e.selected(t)}}},[e._v(" close ")])],1):e._e(),t.id===e.conversation.data.group_creator?s("v-list-item-icon",[s("v-icon",{attrs:{small:"",title:"Group owner"}},[e._v("lock")])],1):e._e()],1)})):e._e()],2)],1)],1)],1)],1),s("v-divider"),s("v-card-actions",[s("v-spacer"),s("v-btn",{on:{click:e.clear_and_close}},[e._v(" Cancel ")]),s("v-btn",{attrs:{dark:"",color:"#3b589e",loading:e.btnloading},on:{click:e.update_members}},[s("v-icon",{attrs:{left:""}},[e._v("save")]),e._v(" Save ")],1)],1)],1)],1)],1)},L=[],S={name:"ManageMemberDialog",props:{conversation:Object,userList:Array},data:function(){return{dialog:!1,all_users:[],filtered_by_search:[],all_selected:[],search:"",btnloading:!1}},computed:{},watch:{conversation:{handler:function(e){e&&e.type&&(this.all_users=d()(this.userList),this.filter_users())},immediate:!0,deep:!0}},methods:{open_dialog:function(){this.dialog=!0,this.conversation.users?this.all_selected=d()(this.conversation.users):this.all_selected=[]},clear_and_close:function(){this.dialog=!1},get_chat_list:function(){var e=this;C.get_chat_list().then((function(t){var s=t.data;e.filtered_by_search=e.filter_users_for_selected(s),e.all_users=d()(s)}))},update_members:function(){var e=this;if(this.all_selected.length<2)this.$event.$emit("open_snackbar","Conversation must have atleast 2 members","error");else{this.btnloading=!0;var t={conversation_id:this.conversation.id,users:this.all_selected.map((function(e){return e.id}))};C.update_members_list(this.conversation.id,t).then((function(t){var s=t.data;e.$emit("conversation-updated",s),e.$event.$emit("open_snackbar","Conversation members updated"),e.clear_and_close()})).finally((function(){return e.btnloading=!1}))}},can_be_remove:function(e){return"undefined"!==typeof e&&(!(!this.conversation.type||!this.conversation.data)&&e.id!==this.conversation.data.group_creator)},select:function(e,t){var s=this.filtered_by_search.findIndex((function(t){return e.id===t.id}));~s&&(this.filtered_by_search[s].is_selected=t)},selected:function(e){var t=this.all_selected.findIndex((function(t){return e.id===t.id}));~t?(this.select(e,!1),this.all_selected.splice(t,1)):(this.select(e,!0),this.all_selected.push(e))},filter_users_for_selected:function(e){var t=this.conversation.users.map((function(e){return e.id}));return e.map((function(e){return Object.assign(e,{is_selected:t.indexOf(e.id)>=0})}))},filter_users:function(e){var t=this;setTimeout((function(){t.search&&""!==t.search?t.filtered_by_search=d()(t.all_users).filter((function(e){return e.fullname.toLowerCase().includes(t.search.toLowerCase().trim())})):t.filtered_by_search=d()(t.all_users)}),1)}}},D=S,E=(s("9455"),Object(f["a"])(D,I,L,!1,null,"6a574c50",null)),B=E.exports,N={components:{ChatBox:y["a"],ChatList:b,GroupChatDialog:P,ManageMembersDialog:B},mixins:[n["a"]],name:"Chat",created:function(){var e=this;this.get_conversation_list((function(){e.$route&&e.$route.params.conversation_id&&e.set_active_base_on_param(e.$route.params.conversation_id)}))},beforeRouteUpdate:function(e,t,s){this.set_active_base_on_param(e.params.conversation_id)},data:function(){return{chatHeight:500}},computed:{list_height:function(){return document.getElementById("chat-list-wrapper")?document.getElementById("chat-list-wrapper").offsetHeight:this.chatHeight},chat_message_height:function(){return this.list_height-this.chat_input_height},chat_input_height:function(){return document.getElementById("chat-input-wrapper")?document.getElementById("chat-input-wrapper").offsetHeight:0}},methods:{set_active_base_on_param:function(e){var t=this.user_list.findIndex((function(t){return t.conversation.id===e}));~t&&(this.active_chat=this.user_list[t].conversation,this.open_conversation(this.user_list[t].conversation));var s=this.group_list.findIndex((function(t){return t.id===e}));~s&&(this.active_chat=this.group_list[t],this.open_conversation(this.group_list[t]))},open_manage_members_dialog:function(){this.$refs.manage_group_members_dialog.open_dialog()},new_groupchat_added:function(e){this.active_chat=e,this.group_list.unshift(e)},conversation_updated:function(e){this.active_chat=e;var t=this.group_list.findIndex((function(t){return t.id===e.id}));~t&&this.group_list.splice(t,1,e)}}},A=N,G=(s("ea02"),Object(f["a"])(A,i,a,!1,null,"e8b6a2da",null));t["default"]=G.exports},"728b":function(e,t,s){},8703:function(e,t,s){},9455:function(e,t,s){"use strict";var i=s("728b"),a=s.n(i);a.a},a63f:function(e,t,s){"use strict";var i=s("c0b0"),a=s.n(i);a.a},b8f0:function(e,t,s){},bf29:function(e,t,s){"use strict";var i=s("8703"),a=s.n(i);a.a},c0b0:function(e,t,s){},ea02:function(e,t,s){"use strict";var i=s("b8f0"),a=s.n(i);a.a}}]);
//# sourceMappingURL=chunk-5d219120.51aa40d7.js.map