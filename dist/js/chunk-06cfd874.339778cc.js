(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06cfd874"],{"967f":function(e,s,t){},e2a5:function(e,s,t){"use strict";var a=t("967f"),n=t.n(a);n.a},e75c:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"message__body team-messages"},[t("div",{ref:"messages-container",staticClass:"messages"},[!1!==e.noMoreData||e.loading?e._e():t("v-row",{staticClass:"pa-3",attrs:{"no-gutters":""}},[t("v-col",{attrs:{md:"12",xs:"12"}},[t("v-spacer"),t("v-btn",{staticClass:"view__more_btn overline",attrs:{text:"",block:""},on:{click:e.load_previous}},[e._v("Load Previous Messages")]),t("v-spacer")],1)],1),e.loading?t("v-progress-linear",{attrs:{indeterminate:!0}}):e._e(),e.items.length?t("v-row",{attrs:{"no-gutters":""}},[t("v-col",{staticClass:"px-3 py-2",staticStyle:{"min-height":"350px"},attrs:{md:"12"}},e._l(e.messages(e.items),(function(e){return t("Message",{key:e.id,attrs:{message:e}})})),1)],1):t("div",{staticClass:"no-messages"},[t("Empty",{attrs:{headline:"No messages yet"}})],1)],1),t("div",{staticClass:"write px-3"},[t("ChatField",{staticClass:"mt-2",attrs:{mentionables:e.mentionables},on:{typing:function(e){},"send-message":e.sendMessage}})],1)])},n=[],i=(t("c5f6"),t("1e4c")),o=t("579d"),r=t("e06e"),c=t("0644"),u=t.n(c),l=t("4752"),m=t("6bdf"),d=t("6385"),g={name:"TeamMessages",mixins:[o["a"],r["a"]],props:{id:[Number,String]},components:{Empty:l["a"],ChatField:m["a"],Message:d["a"]},data:function(){return{loading:!1,message:null,can_message:!1,activeChat:null}},computed:{loggedUser:function(){return this.$store.getters.user},mentionables:function(){return this.activeChat?this.activeChat.members:[]}},mounted:function(){this.$pusher.authenticate(),this.subscribePusher()},beforeDestroy:function(){this.$pusher.unsubscribe("private-project.team-message.".concat(this.id))},created:function(){var e=this;this.loading=!0,this.fill_table_via_url("api/projects/".concat(this.id,"/messages?type=team")),setTimeout((function(){e.scrollToBottomDiv()}),1),this.getConvoDetails(this.id)},methods:{getConvoDetails:function(e){var s=this;i["a"](e).then((function(e){var t=e.data;s.activeChat=t})).finally((function(){s.loading=!1}))},scrollToBottomDiv:function(){var e=this;setTimeout((function(){var s=e.$refs["messages-container"];s&&(s.scrollTop=s.scrollHeight)}),1)},load_previous:function(){this.load_more_via_url("api/projects/".concat(this.id,"/messages?type=team"))},add_new_message:function(e){this.items.some((function(s){return s.id===e.id}))||this.items.unshift(e)},user_can_message:function(e){this.can_message=e,e?console.log("Client chat connected"):this.$event.$emit("open_snackbar","Team chat unavailable.","error")},subscribePusher:function(){var e=this,s=this.$pusher.subscribe("private-project.team-message.".concat(this.id));s.bind("ProjectTeamMessage",(function(s){"team"===s.type&&e.add_new_message(s.message)})),s.bind("pusher:subscription_succeeded",(function(){return e.user_can_message(!0)})),s.bind("pusher:subscription_error",(function(s){return e.user_can_message(!1)}))},sendMessage:function(e){var s=this,t=new FormData;t.append("message",e.message),t.append("type","team"),t.append("from_id",this.loggedUser.id),e.files.length>0&&t.append("file",e.files[0]),i["b"](this.id,t).then((function(e){var t=e.data;s.add_new_message(t)})).finally((function(){s.scrollToBottomDiv(),s.$event.$emit("btnsending_off",!1)}))},messages:function(e){return u()(e).reverse()}}},h=g,p=(t("e2a5"),t("2877")),f=Object(p["a"])(h,a,n,!1,null,"593ad9d2",null);s["default"]=f.exports}}]);
//# sourceMappingURL=chunk-06cfd874.339778cc.js.map