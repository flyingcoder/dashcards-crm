(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e8edede0"],{"70c1":function(e,s,t){},ac31:function(e,s,t){"use strict";var a=t("70c1"),i=t.n(a);i.a},e75c:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"message__body team-messages"},[t("div",{ref:"messages-container",staticClass:"messages"},[!1!==e.noMoreData||e.loading?e._e():t("v-row",{staticClass:"pa-3",attrs:{"no-gutters":""}},[t("v-col",{attrs:{md:"12",xs:"12"}},[t("v-spacer"),t("v-btn",{staticClass:"view__more_btn overline",attrs:{text:"",block:""},on:{click:e.load_previous}},[e._v("Load Previous Messages")]),t("v-spacer")],1)],1),t("Loader",{attrs:{loading:e.loading}}),e.items.length>0?e._l(e.messages(e.items),(function(s){return t("SingleMessage",{key:s.id,attrs:{"is-my-message":s.sender.id===e.loggedUser.id,message:s}})})):t("div",{staticClass:"no-messages"},[t("Empty",{attrs:{headline:"No messages yet"}})],1)],2),t("div",{staticClass:"write"},[t("div",{staticClass:"avatar-wrapper"},[t("img",{staticClass:"sender-avatar",attrs:{src:e.loggedUser.image_url}})]),t("v-text-field",{staticClass:"write__msg",attrs:{solo:"",flat:"","hide-details":"",color:"#667187",label:"Type a message..."},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.sendMessage(s.target.value)}},model:{value:e.message,callback:function(s){e.message=s},expression:"message"}}),t("div",{staticClass:"write__actions"},[t("v-icon",{staticClass:"action insert__emoticon"},[e._v("insert_emoticon")]),t("v-icon",{staticClass:"action attach_file"},[e._v("attach_file")]),t("v-icon",{staticClass:"action send",on:{click:function(s){return e.sendMessage(e.message)}}},[e._v("send")])],1)],1)])},i=[],n=(t("c5f6"),t("1e4c")),r=t("579d"),o=t("e06e"),c=t("0644"),u=t.n(c),l=t("854b"),d=t("5979"),m=t("4752"),g={mixins:[r["a"],o["a"]],props:{id:[Number,String]},components:{Loader:l["a"],SingleMessage:d["a"],Empty:m["a"]},data:function(){return{loading:!1,message:null,can_message:!1}},computed:{loggedUser:function(){return this.$store.getters.user}},mounted:function(){this.$pusher.authenticate(),this.subscribePusher()},beforeDestroy:function(){this.$pusher.unsubscribe("private-project.team-message.".concat(this.id))},created:function(){var e=this;this.loading=!0,this.fill_table_via_url("api/projects/".concat(this.id,"/messages?type=team")),setTimeout((function(){e.scrollToBottomDiv()}),1)},methods:{scrollToBottomDiv:function(){var e=this;setTimeout((function(){var s=e.$refs["messages-container"];s&&(s.scrollTop=s.scrollHeight)}),1)},load_previous:function(){this.load_more_via_url("api/projects/".concat(this.id,"/messages?type=team"))},add_new_message:function(e){this.items.some((function(s){return s.id===e.id}))||this.items.unshift(e)},user_can_message:function(e){this.can_message=e,e?this.$event.$emit("open_snackbar","Team chat connected"):this.$event.$emit("open_snackbar","Team chat disconnected.","error")},subscribePusher:function(){var e=this,s=this.$pusher.subscribe("private-project.team-message.".concat(this.id));s.bind("ProjectTeamMessage",(function(s){"team"===s.type&&e.add_new_message(s.message)})),s.bind("pusher:subscription_succeeded",(function(){return e.user_can_message(!0)})),s.bind("pusher:subscription_error",(function(s){return e.user_can_message(!1)}))},sendMessage:function(e){var s=this;if(e){this.message=null;var t={type:"team",message:e,from_id:this.loggedUser.id};n["a"](this.id,t).then((function(e){var t=e.data;s.add_new_message(t)})).finally((function(){s.scrollToBottomDiv()}))}},messages:function(e){return u()(e).reverse()}}},_=g,v=(t("ac31"),t("2877")),h=Object(v["a"])(_,a,i,!1,null,"4689228e",null);s["default"]=h.exports}}]);
//# sourceMappingURL=chunk-e8edede0.5fafa23e.js.map