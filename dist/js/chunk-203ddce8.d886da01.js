(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-203ddce8"],{3866:function(e,t,s){},"9d83":function(e,t,s){"use strict";var a=s("3866"),n=s.n(a);n.a},e75c:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message__body team-messages"},[s("div",{ref:"messages-container",staticClass:"messages"},[!1!==e.noMoreData||e.loading?e._e():s("v-row",{staticClass:"pa-3",attrs:{"no-gutters":""}},[s("v-col",{attrs:{md:"12",xs:"12"}},[s("v-spacer"),s("v-btn",{staticClass:"view__more_btn overline",attrs:{text:"",block:""},on:{click:e.load_previous}},[e._v("Load Previous Messages")]),s("v-spacer")],1)],1),e.loading?s("v-progress-linear",{attrs:{indeterminate:!0}}):e._e(),e.items.length?s("v-row",{attrs:{"no-gutters":""}},[s("v-col",{staticClass:"px-3 py-2",staticStyle:{"min-height":"350px"},attrs:{md:"12"}},e._l(e.messages(e.items),(function(e){return s("Message",{key:e.id,attrs:{message:e}})})),1)],1):s("div",{staticClass:"no-messages"},[s("Empty",{attrs:{headline:"No messages yet"}})],1)],1),s("div",{staticClass:"write px-3"},[s("ChatField",{staticClass:"mt-2",attrs:{mentionables:e.mentionables},on:{typing:function(e){},"send-message":e.sendMessage}})],1)])},n=[],i=(s("c5f6"),s("1e4c")),o=s("579d"),r=s("e06e"),c=s("0644"),u=s.n(c),l=s("4752"),d=s("6bdf"),m=s("6385"),h={name:"TeamMessages",mixins:[o["a"],r["a"]],props:{id:[Number,String]},components:{Empty:l["a"],ChatField:d["a"],Message:m["a"]},data:function(){return{loading:!1,message:null,can_message:!1,activeChat:null}},computed:{loggedUser:function(){return this.$store.getters.user},mentionables:function(){return this.activeChat?this.activeChat.members:[]},type:function(){return this.$route.params.type||"project"},paths:function(){return[{text:"Dashboard",disabled:!1,router_name:"default-content"},{text:this.type,disabled:!0,router_name:null},{text:"Team Message",disabled:!0,router_name:null}]}},mounted:function(){this.$event.$emit("path-change",this.paths),this.$pusher.authenticate(),this.subscribePusher()},beforeDestroy:function(){this.$pusher.unsubscribe("private-project.team-message.".concat(this.id))},created:function(){var e=this;this.loading=!0,this.fill_table_via_url("api/projects/".concat(this.id,"/messages?type=team")),setTimeout((function(){e.scrollToBottomDiv()}),1),this.getConvoDetails(this.id)},methods:{getConvoDetails:function(e){var t=this;i["a"](e).then((function(e){var s=e.data;t.activeChat=s})).finally((function(){t.loading=!1}))},scrollToBottomDiv:function(){var e=this;setTimeout((function(){var t=e.$refs["messages-container"];t&&(t.scrollTop=t.scrollHeight)}),1)},load_previous:function(){this.load_more_via_url("api/projects/".concat(this.id,"/messages?type=team"))},add_new_message:function(e){this.items.some((function(t){return t.id===e.id}))||this.items.unshift(e)},user_can_message:function(e){this.can_message=e,e?console.log("Client chat connected"):this.$event.$emit("open_snackbar","Team chat unavailable.","error")},subscribePusher:function(){var e=this,t=this.$pusher.subscribe("private-project.team-message.".concat(this.id));t.bind("ProjectTeamMessage",(function(t){"team"===t.type&&e.add_new_message(t.message)})),t.bind("pusher:subscription_succeeded",(function(){return e.user_can_message(!0)})),t.bind("pusher:subscription_error",(function(t){return e.user_can_message(!1)}))},sendMessage:function(e){var t=this,s=new FormData;s.append("message",e.message),s.append("type","team"),s.append("from_id",this.loggedUser.id),e.files.length>0&&s.append("file",e.files[0]),i["b"](this.id,s).then((function(e){var s=e.data;t.add_new_message(s)})).finally((function(){t.scrollToBottomDiv(),t.$event.$emit("btnsending_off",!1)}))},messages:function(e){return u()(e).reverse()}}},p=h,g=(s("9d83"),s("2877")),f=Object(g["a"])(p,a,n,!1,null,"35d7c989",null);t["default"]=f.exports}}]);
//# sourceMappingURL=chunk-203ddce8.d886da01.js.map