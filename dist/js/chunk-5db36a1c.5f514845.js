(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5db36a1c"],{"1ccb":function(e,t,s){"use strict";var a=s("8343"),i=s.n(a);i.a},8323:function(e,t,s){},8343:function(e,t,s){},a39d:function(e,t,s){"use strict";var a=s("8323"),i=s.n(a);i.a},b019:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var a=s("1be9"),i={get_chat_list:function(){return a["a"].get("api/chat/list?for=project&has_msg_count=true")},get_groupchat_list:function(){return a["a"].get("api/chat/group/list?for=project&has_msg_count=true")},get_members_list:function(e){return a["a"].get("api/chat/group/members/".concat(e))},get_messages:function(e){return a["a"].get("api/chat/private/".concat(e))},get_group_messages:function(e){return a["a"].get("api/chat/group/private/".concat(e))},get_more_messages:function(e,t){return a["a"].get("api/chat/private/".concat(e,"?page=").concat(t+1))},send_message:function(e){return a["a"].post("api/chat/private",e)},send_group_message:function(e){return a["a"].post("api/chat/group/private",e)},save_group:function(e){return a["a"].post("api/chat/group",e)},update_members_list:function(e){return a["a"].post("api/chat/group/update-members",e)},remove_from_group:function(e){return a["a"].post("api/chat/group/remove-member",e)}}},dd50:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message__body team-messages"},[s("div",{ref:"messages-container",staticClass:"messages"},[s("v-row",{staticClass:"pa-3",attrs:{"no-gutters":""}},[s("v-spacer"),s("v-col",[!1!==e.noMoreData||e.loading?e._e():s("v-btn",{staticClass:"view__more_btn overline",attrs:{text:""},on:{click:e.load_previous}},[e._v("Load Previous Messages")])],1),s("v-spacer"),s("v-col",{attrs:{md:"1"}},[s("v-menu",{attrs:{bottom:"",left:"","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-btn",e._g({attrs:{outlined:"",icon:""}},a),[s("v-icon",{attrs:{small:""}},[e._v("settings")])],1)]}}])},[s("v-list",[s("v-list-item",{on:{click:e.open_manage_member_dialog}},[s("v-list-item-title",[e._v("Manage Members")])],1)],1)],1)],1)],1),s("Loader",{attrs:{loading:e.loading}}),e.items.length?e._l(e.messages(e.items),(function(t){return s("SingleMessage",{key:t.id,attrs:{"is-my-message":t.sender.id===e.loggedUser.id,message:t}})})):s("div",{staticClass:"no-messages"},[s("Empty",{attrs:{headline:"No messages yet"}})],1)],2),s("div",{staticClass:"write"},[s("div",{staticClass:"avatar-wrapper"},[s("img",{staticClass:"sender-avatar",attrs:{src:e.loggedUser.image_url}})]),s("v-text-field",{staticClass:"write__msg",attrs:{solo:"",flat:"","hide-details":"",color:"#667187",label:"Type a message..."},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t.target.value)}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),s("div",{staticClass:"write__actions"},[s("v-icon",{staticClass:"action insert__emoticon"},[e._v("insert_emoticon")]),s("v-icon",{staticClass:"action attach_file"},[e._v("attach_file")]),s("v-icon",{staticClass:"action send",on:{click:function(t){return e.sendMessage(e.message)}}},[e._v("send")])],1)],1),s("ManageClientChatMember",{ref:"manage_group_members_dialog",attrs:{conversation:e.activeChat}})],1)},i=[],n=(s("c5f6"),s("1be9")),r=s("1e4c"),c=function(e){return n["a"].get("api/chat/group/client/".concat(e))},o=s("579d"),l=s("e06e"),u=s("0644"),d=s.n(u),_=s("854b"),m=s("5979"),v=s("4752"),g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.conversation?s("div",{staticClass:"text-center"},[s("v-dialog",{attrs:{"max-width":"800",persistent:"",scrollable:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[e._v(" Manage Members "),s("v-spacer"),s("v-icon",{on:{click:function(t){return e.clear_and_close()}}},[e._v("close")])],1),s("v-card-text",[s("v-container",[s("v-row",[s("v-flex",{attrs:{sm12:"",md8:""}},[s("v-text-field",{attrs:{solo:"",label:"Search for people to add",required:"",clearable:"","prepend-inner-icon":"search"},on:{keydown:e.filter_users,"click:clear":e.filter_users},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e.filtered_by_search.length>0?s("v-list",{attrs:{id:"filtered_by_search_wrapper"}},e._l(e.filtered_by_search,(function(t){return s("v-list-item",{key:t.title,on:{click:function(s){return e.selected(t)}}},[s("v-list-item-avatar",[s("v-img",{attrs:{src:t.image_url}})],1),s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.fullname)}})],1),s("v-list-item-icon",[s("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.is_selected,expression:"item.is_selected"}],attrs:{color:"success"}},[e._v("mdi-checkbox-marked-circle")])],1)],1)})),1):e._e()],1),s("v-flex",{attrs:{sm12:"",md4:""}},[s("v-list",{attrs:{id:"all_selected_wrapper"}},[s("v-subheader",[e._v("Selected ("+e._s(e.all_selected.length)+")")]),e._l(e.all_selected,(function(t){return e.all_selected.length>0?s("v-list-item",{key:t.title},[s("v-list-item-avatar",[s("v-img",{attrs:{src:t.image_url}})],1),s("v-list-item-content",[s("v-list-item-subtitle",{domProps:{textContent:e._s(t.fullname)}})],1),e.can_be_remove(t)?s("v-list-item-icon",[s("v-icon",{attrs:{small:"",color:"danger"},on:{click:function(s){return e.selected(t)}}},[e._v("close")])],1):e._e()],1):e._e()}))],2)],1)],1)],1)],1),s("v-divider"),s("v-card-actions",[s("v-spacer"),s("v-btn",{on:{click:e.clear_and_close}},[e._v(" Cancel ")]),s("v-btn",{attrs:{color:"primary",loading:e.btnloading},on:{click:e.update_members}},[e._v(" Save ")])],1)],1)],1)],1):e._e()},f=[],h=(s("386d"),s("20d6"),s("6762"),s("2fdb"),s("ac6a"),s("8615"),s("b019")),p={name:"ManageClientChatMember",props:{conversation:Object},data:function(){return{dialog:!1,all_users:[],filtered_by_search:[],all_selected:[],search:"",btnloading:!1}},methods:{open_dialog:function(){this.dialog=!0,this.all_selected=d()(this.conversation.members),this.get_chat_list()},clear_and_close:function(){this.dialog=!1},get_chat_list:function(){var e=this;h["a"].get_chat_list().then((function(t){var s=t.data;e.filtered_by_search=e.filter_users_for_selected(s),e.all_users=d()(s)}))},update_members:function(){var e=this;this.btnloading=!0;var t={convo_id:this.conversation.id,users:this.all_selected.map((function(e){return e.id}))};h["a"].update_members_list(t).then((function(t){var s=t.data;e.conversation.members=s,e.clear_and_close()})).finally((function(){return e.btnloading=!1}))},can_be_remove:function(e){var t=Object.values(e.user_roles);return!t.includes("admin")&&!t.includes("manager")},select:function(e,t){var s=this.filtered_by_search.findIndex((function(t){return e.id===t.id}));~s&&(this.filtered_by_search[s].is_selected=t)},selected:function(e){var t=this.all_selected.findIndex((function(t){return e.id===t.id}));~t?(this.select(e,!1),this.all_selected.splice(t,1)):(this.select(e,!0),this.all_selected.push(e))},filter_users_for_selected:function(e){var t=this.conversation.members.map((function(e){return e.id}));return e.map((function(e){return Object.assign(e,{is_selected:t.indexOf(e.id)>=0})}))},filter_users:function(e){var t=this;setTimeout((function(){t.search&&""!==t.search?t.filtered_by_search=d()(t.all_users).filter((function(e){return e.fullname.toLowerCase().includes(t.search.toLowerCase().trim())})):t.filtered_by_search=d()(t.all_users)}),1)}}},b=p,y=(s("1ccb"),s("2877")),C=Object(y["a"])(b,g,f,!1,null,"2ec3f1c9",null),k=C.exports,w={mixins:[o["a"],l["a"]],props:{id:[Number,String]},components:{Loader:_["a"],SingleMessage:m["a"],Empty:v["a"],ManageClientChatMember:k},data:function(){return{loading:!1,message:null,can_message:!1,activeChat:null}},computed:{loggedUser:function(){return this.$store.getters.user}},created:function(){var e=this;this.loading=!0,this.fill_table_via_url("api/projects/".concat(this.id,"/messages?type=client")),setTimeout((function(){e.scrollToBottomDiv()}),1),this.getConvoDetails(this.id)},mounted:function(){this.$pusher.authenticate(),this.subscribePusher()},beforeDestroy:function(){this.$pusher.unsubscribe("private-project.client-message.".concat(this.id))},methods:{open_manage_member_dialog:function(){this.$refs.manage_group_members_dialog.open_dialog()},getConvoDetails:function(e){var t=this;c(e).then((function(e){var s=e.data;t.activeChat=s}))},scrollToBottomDiv:function(){var e=this;setTimeout((function(){var t=e.$refs["messages-container"];t&&(t.scrollTop=t.scrollHeight)}),1)},load_previous:function(){this.load_more_via_url("api/projects/".concat(this.id,"/messages?type=client"))},add_new_message:function(e){this.items.some((function(t){return t.id===e.id}))||this.items.unshift(e)},user_can_message:function(e){this.can_message=e,e?this.$event.$emit("open_snackbar","Client chat connected"):this.$event.$emit("open_snackbar","Client chat unavailable for you.","error")},subscribePusher:function(){var e=this,t=this.$pusher.subscribe("private-project.client-message.".concat(this.id));t.bind("ProjectClientMessage",(function(t){"client"===t.type&&e.add_new_message(t.message)})),t.bind("pusher:subscription_succeeded",(function(){return e.user_can_message(!0)})),t.bind("pusher:subscription_error",(function(t){return e.user_can_message(!1)}))},sendMessage:function(e){var t=this;if(e){this.message=null;var s={type:"client",message:e,from_id:this.loggedUser.id};r["a"](this.id,s).then((function(e){var s=e.data;t.add_new_message(s)})).finally((function(){t.scrollToBottomDiv()}))}},messages:function(e){return d()(e).reverse()}}},x=w,M=(s("a39d"),Object(y["a"])(x,a,i,!1,null,"55ad40a4",null));t["default"]=M.exports}}]);
//# sourceMappingURL=chunk-5db36a1c.5f514845.js.map