(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-771f4550"],{"1e4c":function(e,s,t){"use strict";t.d(s,"a",(function(){return n})),t.d(s,"b",(function(){return i}));var a=t("1be9"),n=function(e){return a["a"].get("api/projects/".concat(e,"/messages?type=team"))},i=function(e,s){return a["a"].post("api/projects/".concat(e,"/messages"),s)}},3416:function(e,s,t){"use strict";var a=t("3f9e"),n=t.n(a);n.a},"3f9e":function(e,s,t){},"572b":function(e,s,t){"use strict";var a=t("b2bb"),n=t.n(a);n.a},5979:function(e,s,t){"use strict";var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"message",class:{me:e.isMyMessage}},[t("v-layout",{staticClass:"sender",attrs:{wrap:""}},[t("v-flex",{staticClass:"sender__img",attrs:{xs3:""}},[t("v-img",{attrs:{src:e.message.sender.image_url}}),t("span",{staticClass:"status",class:e.is_online})],1),t("v-flex",{staticClass:"sender__name",attrs:{xs5:""}},[t("h5",[e._v(e._s(e.message.sender.first_name)+" "+e._s(e.message.sender.last_name))])]),t("v-flex",{staticClass:"date",attrs:{xs4:""}},[e._v(" "+e._s(e._f("from_now")(e.message.created_at))+" ")])],1),t("div",{staticClass:"sender__message"},[e._v(" "+e._s(e.message.body)+" ")])],1)},n=[],i=(t("20d6"),t("579d")),r={mixins:[i["a"]],props:{isMyMessage:Boolean,message:Object},computed:{is_online:function(){var e=this,s=this.$store.getters["onlineUsers/all_users"],t=s.findIndex((function(s){return s.id===e.message.sender.id}));return~t?"online":"offline"}}},c=r,o=(t("3416"),t("2877")),u=Object(o["a"])(c,a,n,!1,null,"7a2263c5",null);s["a"]=u.exports},"7e6a":function(e,s,t){"use strict";var a=t("e992"),n=t.n(a);n.a},"854b":function(e,s,t){"use strict";var a=function(e,s){var t=s._c;return s.props.loading?t("transition",{attrs:{name:"fade"}},[t("div",{staticClass:"custom-loader"},[t("v-progress-circular",{attrs:{indeterminate:"",color:"primary",size:72}})],1)]):s._e()},n=[],i={props:{loading:Boolean}},r=i,c=(t("7e6a"),t("2877")),o=Object(c["a"])(r,a,n,!0,null,"0a16da3c",null);s["a"]=o.exports},b2bb:function(e,s,t){},dd50:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"message__body team-messages"},[t("div",{ref:"messages-container",staticClass:"messages"},[t("Loader",{attrs:{loading:e.loading}}),e.messages.length?e._l(e.messages,(function(s){return t("SingleMessage",{key:s.id,attrs:{"is-my-message":s.sender.id===e.loggedUser.id,message:s}})})):t("div",{staticClass:"no-messages"},[e._v(" No messages yet ")])],2),t("div",{staticClass:"write"},[t("div",{staticClass:"avatar-wrapper"},[t("img",{staticClass:"sender-avatar",attrs:{src:e.loggedUser.image_url}})]),t("v-text-field",{staticClass:"write__msg",attrs:{solo:"",flat:"","hide-details":"",color:"#667187",label:"Type a message..."},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.sendMessage(s.target.value)}},model:{value:e.message,callback:function(s){e.message=s},expression:"message"}}),t("div",{staticClass:"write__actions"},[t("v-icon",{staticClass:"action insert__emoticon"},[e._v("insert_emoticon")]),t("v-icon",{staticClass:"action attach_file"},[e._v("attach_file")]),t("v-icon",{staticClass:"action send",on:{click:function(s){return e.sendMessage(e.message)}}},[e._v("send")])],1)],1),t("div",{staticClass:"view__more"},[t("v-btn",{staticClass:"view__more_btn",attrs:{text:""}},[e._v("VIEW MORE")])],1)])},n=[],i=(t("c5f6"),t("1be9")),r=t("1e4c"),c=function(e){return i["a"].get("api/projects/".concat(e,"/messages?type=client"))},o=t("579d"),u=t("854b"),l=t("5979"),d={mixins:[o["a"]],props:{id:[Number,String]},components:{Loader:u["a"],SingleMessage:l["a"]},data:function(){return{loading:!1,messages:[],message:null,can_message:!1}},computed:{loggedUser:function(){return this.$store.getters.user}},created:function(){var e=this;this.loading=!0,c(this.id).then((function(s){var t=s.data;e.messages=t.data,e.scrollToBottom(e.$refs["messages-container"])})).finally((function(){return e.loading=!1}))},mounted:function(){this.$pusher.authenticate(),this.subscribePusher()},beforeDestroy:function(){this.$pusher.unsubscribe("private-project.client-message.".concat(this.id))},methods:{add_new_message:function(e){this.messages.some((function(s){return s.id===e.id}))||this.messages.push(e),this.scrollToBottom(this.$refs["messages-container"])},user_can_message:function(e){this.can_message=e,e?this.$event.$emit("open_snackbar","Client chat connected"):this.$event.$emit("open_snackbar","Client chat unavailable for you.","error")},subscribePusher:function(){var e=this,s=this.$pusher.subscribe("private-project.client-message.".concat(this.id));s.bind("ProjectClientMessage",(function(s){"client"===s.type&&e.add_new_message(s.message)})),s.bind("pusher:subscription_succeeded",(function(){return e.user_can_message(!0)})),s.bind("pusher:subscription_error",(function(s){return e.user_can_message(!1)}))},sendMessage:function(e){var s=this;if(e){this.message=null;var t={type:"client",message:e,from_id:this.loggedUser.id};r["b"](this.id,t).then((function(e){var t=e.data;s.add_new_message(t)}))}}}},g=d,m=(t("572b"),t("2877")),_=Object(m["a"])(g,a,n,!1,null,"12d34468",null);s["default"]=_.exports},e992:function(e,s,t){}}]);
//# sourceMappingURL=chunk-771f4550.9bd21c8d.js.map