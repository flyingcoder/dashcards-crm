{"version":3,"sources":["webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?0c07","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?8ee7","webpack:///src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue?05ce","webpack:///./src/modules/ProjectPreview-Messages/subpages/TeamMessages/TeamMessages.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","noMoreData","loading","_e","attrs","on","load_previous","_v","items","staticStyle","_l","messages","message","key","id","mentionables","$event","sendMessage","staticRenderFns","component"],"mappings":"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","file":"js/chunk-48443050.6c0914c7.js","sourcesContent":["import mod from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=style&index=0&id=4c0cb5bd&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=style&index=0&id=4c0cb5bd&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"message__body team-messages\"},[_c('div',{ref:\"messages-container\",staticClass:\"messages\"},[(_vm.noMoreData === false && !_vm.loading)?_c('v-row',{staticClass:\"pa-3\",attrs:{\"no-gutters\":\"\"}},[_c('v-col',{attrs:{\"md\":\"12\",\"xs\":\"12\"}},[_c('v-spacer'),_c('v-btn',{staticClass:\"view__more_btn overline\",attrs:{\"text\":\"\",\"block\":\"\"},on:{\"click\":_vm.load_previous}},[_vm._v(\"Load Previous Messages\")]),_c('v-spacer')],1)],1):_vm._e(),(_vm.loading)?_c('v-progress-linear',{attrs:{\"indeterminate\":true}}):_vm._e(),(_vm.items.length)?_c('v-row',{attrs:{\"no-gutters\":\"\"}},[_c('v-col',{staticClass:\"px-3 py-2\",staticStyle:{\"min-height\":\"350px\"},attrs:{\"md\":\"12\"}},_vm._l((_vm.messages(_vm.items)),function(message){return _c('Message',{key:message.id,attrs:{\"message\":message}})}),1)],1):_c('div',{staticClass:\"no-messages\"},[_c('Empty',{attrs:{\"icon\":\"mdi-cellphone-message-off\",\"headline\":\"No messages yet\"}})],1)],1),_c('div',{staticClass:\"write px-3\"},[_c('ChatField',{staticClass:\"mt-2\",attrs:{\"mentionables\":_vm.mentionables},on:{\"typing\":function($event){},\"send-message\":_vm.sendMessage}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"message__body team-messages\">\r\n        <div class=\"messages\" ref=\"messages-container\">\r\n            <v-row no-gutters class=\"pa-3\" v-if=\"noMoreData === false && !loading\">\r\n                <v-col md=\"12\" xs=\"12\">\r\n                    <v-spacer></v-spacer>\r\n                    <v-btn text block class=\"view__more_btn overline\" @click=\"load_previous\">Load Previous Messages</v-btn>\r\n                    <v-spacer></v-spacer>\r\n                </v-col>\r\n            </v-row>\r\n            <v-progress-linear v-if=\"loading\" :indeterminate=\"true\"></v-progress-linear>\r\n            <v-row no-gutters v-if=\"items.length\">\r\n                <v-col md=\"12\" class=\"px-3 py-2\" style=\"min-height: 350px;\">\r\n                    <Message v-for=\"message in messages(items)\" :message=\"message\" :key=\"message.id\"></Message>\r\n                </v-col>\r\n            </v-row>\r\n            <div class=\"no-messages\" v-else>\r\n                <Empty  icon=\"mdi-cellphone-message-off\" headline=\"No messages yet\"></Empty>\r\n            </div>\r\n        </div>\r\n        <div class=\"write px-3\">\r\n            <ChatField class=\"mt-2\" :mentionables=\"mentionables\" @typing=\"\" @send-message=\"sendMessage\"></ChatField>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\nimport * as apiTo from './api'\r\nimport { global_utils } from '@/global_utils/global_utils'\r\nimport { list_functionality } from '@/services/list-functionality/list-functionality'\r\nimport _cloneDeep from 'lodash/cloneDeep'\r\n\r\n// Components \r\nimport ChatField from '@/common/ChatBox/ChatField.vue'\r\nimport Message from '@/modules/Chat/components/Message/Message.vue'\r\n\r\nexport default {\r\n    name: 'TeamMessages',\r\n    mixins: [global_utils, list_functionality],\r\n    props: {\r\n        id: [Number, String]\r\n    },\r\n    components: { \r\n        ChatField,\r\n        Message\r\n    },\r\n\r\n    data: () => ({\r\n        loading: false,\r\n        message: null,\r\n        can_message: false,\r\n        activeChat: null\r\n    }),\r\n\r\n    computed: {\r\n        loggedUser() {\r\n            return this.$store.getters.user\r\n        },\r\n        mentionables() {\r\n            if (!this.activeChat) {\r\n                return []\r\n            }\r\n            return this.activeChat.members\r\n        },\r\n        type() {\r\n            return this.$route.params.type || 'project'\r\n        },\r\n        paths() {\r\n            return [\r\n                { text: 'Dashboard', disabled: false, router_name: 'default-content' },\r\n                { text: this.type, disabled: true, router_name: null },\r\n                { text: 'Team Message', disabled: true, router_name: null }\r\n            ]\r\n        }\r\n    },\r\n    mounted() {\r\n        this.$event.$emit('path-change', this.paths)\r\n        this.$pusher.authenticate()\r\n        this.subscribePusher()\r\n    },\r\n    beforeDestroy() {\r\n        this.$pusher.unsubscribe(`private-project.team-message.${this.id}`)\r\n    },\r\n    created() {\r\n        this.loading = true\r\n        this.fill_table_via_url(`api/projects/${this.id}/messages?type=team`)\r\n        setTimeout(() => {\r\n            this.scrollToBottomDiv()\r\n        }, 1)\r\n        this.getConvoDetails(this.id)\r\n    },\r\n\r\n    methods: {\r\n        getConvoDetails(id) {\r\n            apiTo\r\n                .get_client_convo_details(id)\r\n                .then(({ data }) => {\r\n                    this.activeChat = data\r\n                })\r\n                .finally(() => {\r\n                    this.loading = false\r\n                })\r\n        },\r\n        scrollToBottomDiv() {\r\n            setTimeout(() => {\r\n                const wrapper = this.$refs['messages-container']\r\n                if (wrapper) {\r\n                    wrapper.scrollTop = wrapper.scrollHeight\r\n                }\r\n            }, 1)\r\n        },\r\n        load_previous() {\r\n            this.load_more_via_url(`api/projects/${this.id}/messages?type=team`)\r\n        },\r\n        add_new_message(message) {\r\n            if (!this.items.some(msg => msg.id === message.id)) {\r\n                this.items.unshift(message)\r\n            }\r\n        },\r\n        user_can_message(can) {\r\n            this.can_message = can\r\n            if (can) console.log('Client chat connected')\r\n            else this.$event.$emit('open_snackbar', 'Team chat unavailable.', 'error')\r\n        },\r\n        subscribePusher() {\r\n            const team_message_channel = this.$pusher.subscribe(\r\n                `private-project.team-message.${this.id}`\r\n            )\r\n            team_message_channel.bind('ProjectTeamMessage', data => {\r\n                if (data.type === 'team') this.add_new_message(data.message)\r\n            })\r\n            team_message_channel.bind('pusher:subscription_succeeded', () =>\r\n                this.user_can_message(true)\r\n            )\r\n            team_message_channel.bind('pusher:subscription_error', status =>\r\n                this.user_can_message(false)\r\n            )\r\n        },\r\n        sendMessage(data) {\r\n            let formData = new FormData()\r\n            formData.append('message', data.message)\r\n            formData.append('type', 'team')\r\n            formData.append('from_id', this.loggedUser.id)\r\n\r\n            if (data.files.length > 0) {\r\n                formData.append('file', data.files[0])\r\n            }\r\n\r\n            apiTo\r\n                .send_message(this.id, formData)\r\n                .then(({ data }) => {\r\n                    this.add_new_message(data)\r\n                })\r\n                .finally(() => {\r\n                    this.scrollToBottomDiv()\r\n                    this.$event.$emit('btnsending_off', false)\r\n                })\r\n        },\r\n        messages(items) {\r\n            return _cloneDeep(items).reverse()\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import '~@/sass/_variables';\r\n\r\n.message__body {\r\n    border: 1px solid $borderLightGray;\r\n    border-bottom-left-radius: 10px;\r\n    border-bottom-right-radius: 10px;\r\n\r\n    @include styledScrollFor('.messages'); //style the scroll\r\n\r\n    .messages {\r\n        background-color: $white;\r\n        overflow: auto;\r\n        max-height: 462px;\r\n        border-bottom: 1px solid $borderLightGray;\r\n    }\r\n\r\n    .write {\r\n        display: flex;\r\n        flex-direction: row;\r\n        flex-wrap: nowrap;\r\n        align-items: center;\r\n        background-color: $white;\r\n\r\n        .write__actions {\r\n            .action {\r\n                margin: 5px 7px;\r\n                color: $lightGray-2;\r\n                cursor: pointer;\r\n\r\n                &:hover {\r\n                    color: $blue;\r\n                }\r\n            }\r\n        }\r\n\r\n        .avatar-wrapper {\r\n            padding: 3px;\r\n\r\n            .sender-avatar {\r\n                width: 40px;\r\n            }\r\n        }\r\n    }\r\n\r\n    .view__more {\r\n        text-align: center;\r\n        padding: 10px;\r\n        border-top: 1px solid $borderLightGray;\r\n        background-color: $white;\r\n        border-bottom-left-radius: 10px;\r\n        border-bottom-right-radius: 10px;\r\n\r\n        .view__more_btn {\r\n            color: $tableDarkText;\r\n        }\r\n    }\r\n}\r\n</style>","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TeamMessages.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TeamMessages.vue?vue&type=template&id=4c0cb5bd&scoped=true&\"\nimport script from \"./TeamMessages.vue?vue&type=script&lang=js&\"\nexport * from \"./TeamMessages.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TeamMessages.vue?vue&type=style&index=0&id=4c0cb5bd&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4c0cb5bd\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}